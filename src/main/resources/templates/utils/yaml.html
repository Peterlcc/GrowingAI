<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>

	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta name="description" content="">
	<meta name="author" content="">

	<title>YAML参数配置</title>

	<!-- Bootstrap core CSS -->
	<link th:href="@{/webjars/bootstrap/4.3.1/css/bootstrap.css}" href="asserts/css/bootstrap.min.css" rel="stylesheet">

	<!-- Custom styles for this template -->
	<link th:href="@{/css/modern-business.css}" href="css/modern-business.css" rel="stylesheet">
	<link th:href="@{/css/codemirror/codemirror.css}" rel="stylesheet">
	<link th:href="@{/css/codemirror/simplescrollbars.css}" rel="stylesheet">
	<link th:href="@{/css/codemirror/idea.css}" rel="stylesheet">

</head>

<body>

<div th:replace="commons/base::topbar"></div>

<!-- Page Content -->
<div class="container">

	<!-- Page Heading/Breadcrumbs -->
	<h1 class="mt-4 mb-3">可成长系统之
		<small>YAML参数配置</small>
	</h1>

	<ol class="breadcrumb">
		<li class="breadcrumb-item">
			<a th:href="@{/index}" href="index.html">首页</a>
		</li>
		<li class="breadcrumb-item active">YAML参数配置</li>
	</ol>

		<div class="row" th:with="i=1">

			<!-- Post Content Column -->
			<div class="col-lg-8">

				<form id="yamlForm" th:action="@{/param/save}" method="post" th:attr="download=@{/param/download.yaml}">
					<div>
						<div id="cards">
					<!-- Comments Form -->
					<div class="card my-4" th:if="${yaml!=null}" th:each="data,dataStat:${yaml}">
						<h5 class="card-header" th:text="${yamlNameText}">Leave a Comment:</h5>
						<div class="card-body">
								<div class="form-group">
									<input class="form-control" th:name="'name'+${dataStat.index}" th:value="${data.key}">
									<input class="form-control" th:name="'value'+${dataStat.index}" th:value="${data.value}">
								</div>
								<button type="button" onclick="deleteCard(this);" class="btn btn-primary">删除当前项</button>
						</div>
					</div>
						</div>
					<div class="card my-4">
						<h5 class="card-header">操作</h5>
						<div class="card-body">
							<div class="mb-3">
								<button type="button" onclick="generateYaml();" class="btn btn-primary form-control mb-3">生成yaml文件</button>
								<button type="button" onclick="addCard();" class="btn btn-primary form-control mb-3">增加一项</button>
							</div>
						</div>
					</div>
					</div>
				</form>
			</div>

			<!-- Sidebar Widgets Column -->
			<div class="col-md-4">

				<!-- Categories Widget -->
				<div class="card my-4">
					<h5 class="card-header">YAML参数库</h5>
					<div class="card-body">
						<div class="row">
							<div class="col-lg-12">
								<ul class="mb-0">
<!--									<li th:each="name:${yamlNames}"><a href="#" th:text="${name}">Web Design</a></li>-->
									<li class="col-lg-6" th:each="name:${yamlNames}"><a th:href="@{'/param/yaml?name='+${name}}" class="btn btn-primary mb-3" th:text="${name}">Web Design</a></li>
								</ul>
							</div>
						</div>
					</div>
				</div>

				<!-- Side Widget -->
				<div class="card my-4">
					<h5 class="card-header">说明</h5>
					<div class="card-body">先从yaml参数库中选择一个，
						然后根据自己的需求进行修改即可</div>
				</div>

			</div>

		</div>
		<!-- /.row -->

	</div>
	<!-- /.container -->

<script th:inline="javascript">
	var indexGlobal=[[${indexGlobal}]];
	var yamlNameText=[[${yamlNameText}]];

	function deleteCard(btn) {
		var cardBody=$(btn).parent();
		var card=cardBody.parent();
		card.remove();
	}

	function addCard() {
		var inputName=$("<input class='form-control'>");
		inputName.attr("name","name"+indexGlobal);
		inputName.attr("value","default");

		var inputValue=$("<input class='form-control'>");
		inputValue.attr("name","value"+indexGlobal);
		inputValue.attr("value","default");

		var formGroup=$("<div class='form-group'>");
		formGroup.append(inputName);
		formGroup.append(inputValue);

		var btn=$('<button type="button" class="btn btn-primary">删除当前项</button>');

		var cardBody=$('<div class="card-body"></div>');
		cardBody.append(formGroup);
		cardBody.append(btn);

		var cardHead=$('<h5 class="card-header">Leave a Comment:</h5>');
		cardHead.text(yamlNameText);

		var card=$('<div class="card my-4"></div>');
		card.append(cardHead);
		card.append(cardBody);

		$("#cards").append(card);

		indexGlobal=indexGlobal+1;
	}

	function generateYaml() {
		console.log($('#yamlForm').attr("action"));
		console.log($('#yamlForm').serialize());
		$.ajax({
			//几个参数需要注意一下
			type: "POST",//方法类型
			// dataType: "json",//预期服务器返回的数据类型
			url: $('#yamlForm').attr("action") ,//url
			data: $('#yamlForm').serialize(),
			success: function (result) {
				console.log(result);//打印服务端返回的数据(调试用)
				window.location.href=$('#yamlForm').attr('download')+'?name='+result
			},
			error : function() {
				alert("异常！出问题了");
			}
		});
	}

</script>
<!-- Bootstrap core JavaScript -->
<script type="text/javascript" th:src="@{/webjars/jquery/3.4.1/jquery.min.js}"></script>
<script th:src="@{/webjars/bootstrap/4.3.1/js/bootstrap.bundle.js}"></script>
<script th:src="@{/js/LuTree.js}"></script>
<script th:src="@{/js/codemirror/codemirror.js}"></script>
<script th:src="@{/js/codemirror/simplescrollbars.js}"></script>
<script th:src="@{/js/codemirror/python.js}"></script>
<script th:src="@{/js/codemirror/cmake.js}"></script>
<script th:src="@{/js/codemirror/clike.js}"></script>
<script th:src="@{/js/codemirror/xml.js}"></script>

</body>

</html>
